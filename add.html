<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>問題追加｜Study Habits</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f4f4f4;
}
header {
  background: #b00020;
  color: white;
  text-align: center;
  padding: 16px;
  font-size: 18px;
  font-weight: bold;
}
main {
  max-width: 600px;
  margin: auto;
  padding: 16px;
}
.card {
  background: white;
  padding: 16px;
  border-radius: 12px;
}
input, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  margin-bottom: 12px;
}
button {
  padding: 12px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
}
.generate {
  background: #eee;
}
.save {
  background: #b00020;
  color: white;
  width: 100%;
  margin-top: 16px;
}
</style>
</head>

<body>

<header>問題を追加</header>

<main>
<div class="card">

<label>問題文</label>
<input id="question" placeholder="例：HRBPの主な役割は？">

<label>正解</label>
<input id="answer" placeholder="正解を入力">

<button class="generate" onclick="generateChoices()">
不正解候補を提案
</button>

<div id="choicesArea"></div>

<label>解説（任意）</label>
<textarea id="explanation" placeholder="未入力でも保存できます"></textarea>

<button class="save" onclick="saveQuestion()">保存</button>

</div>
</main>

<script>
function generateChoices() {
  const answer = document.getElementById("answer").value.trim();
  if (!answer) {
    alert("正解を先に入力してください");
    return;
  }

  const candidates = [
    answer + "の一部",
    answer + "のみを担当する",
    "主に管理業務を行う",
    "経営とは関与しない",
    "現場業務が中心である"
  ];

  const area = document.getElementById("choicesArea");
  area.innerHTML = "<p>不正解候補（選択）</p>";

  candidates.forEach(text => {
    const label = document.createElement("label");
    label.innerHTML = `
      <input type="checkbox" value="${text}"> ${text}
    `;
    area.appendChild(label);
    area.appendChild(document.createElement("br"));
  });
}

function saveQuestion() {
  const question = document.getElementById("question").value.trim();
  const answer = document.getElementById("answer").value.trim();
  const explanation =
    document.getElementById("explanation").value.trim();

  if (!question || !answer) {
    alert("問題文と正解は必須です");
    return;
  }

  const selected =
    [...document.querySelectorAll("#choicesArea input:checked")]
    .map(i => i.value);

  if (selected.length < 3) {
    alert("不正解を3つ以上選んでください");
    return;
  }

  const choices =
    [answer, ...selected.slice(0,3)]
    .sort(() => Math.random() - 0.5);

  const data =
    JSON.parse(localStorage.getItem("questions")) || [];

  data.push({
    id: crypto.randomUUID(),
    question,
    choices,
    answer,
    explanation: explanation || ""
  });

  localStorage.setItem("questions", JSON.stringify(data));

  alert("保存しました");
  location.href = "index.html";
}
</script>

</body>
</html>
