<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>問題追加｜Study Habits</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f4f4f4;
}
header {
  background: #b00020;
  color: white;
  text-align: center;
  padding: 16px;
  font-size: 18px;
  font-weight: bold;
}
main {
  max-width: 600px;
  margin: auto;
  padding: 16px;
}
.card {
  background: white;
  padding: 16px;
  border-radius: 12px;
}
label {
  font-weight: bold;
}
input, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  margin-bottom: 12px;
}
.choice-row {
  display: flex;
  gap: 6px;
  margin-bottom: 8px;
}
.choice-row input[type="text"] {
  flex: 1;
}
.choice-row button {
  background: #ddd;
  border-radius: 6px;
  padding: 0 10px;
}
button {
  padding: 12px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
}
.generate {
  background: #eee;
  width: 100%;
  margin-bottom: 8px;
}
.add {
  background: #ddd;
  width: 100%;
  margin-bottom: 12px;
}
.save {
  background: #b00020;
  color: white;
  width: 100%;
  margin-top: 16px;
}
</style>
</head>

<body>

<header>問題を追加</header>

<main>
<div class="card">

<label>問題文</label>
<input id="question" placeholder="例：HRBPの主な役割は？">

<label>正解</label>
<input id="answer" placeholder="正解を入力">

<button class="generate" onclick="generateWrongChoices()">
不正解候補を自動生成
</button>

<button class="add" onclick="addWrongChoice()">
＋ 不正解候補を追加
</button>

<div id="wrongChoices"></div>

<label>解説（任意）</label>
<textarea id="explanation" placeholder="未入力でも保存できます"></textarea>

<button class="save" onclick="saveQuestion()">保存</button>

</div>
</main>

<script>
const wrongArea = document.getElementById("wrongChoices");

function addWrongChoice(text = "") {
  const row = document.createElement("div");
  row.className = "choice-row";
  row.innerHTML = `
    <input type="checkbox">
    <input type="text" placeholder="不正解候補" value="${text}">
    <button onclick="this.parentElement.remove()">×</button>
  `;
  wrongArea.appendChild(row);
}

function generateWrongChoices() {
  const answer = document.getElementById("answer").value.trim();
  if (!answer) {
    alert("正解を入力してください");
    return;
  }

  wrongArea.innerHTML = "";

  const templates = [
    "主に事務作業を担当する役割",
    "経営には関与しない立場",
    "現場業務のみを行う",
    "人事制度の運用だけを担う",
    "短期的な業務改善が目的"
  ];

  templates.forEach(t => addWrongChoice(t));
}

function saveQuestion() {
  const question = document.getElementById("question").value.trim();
  const answer = document.getElementById("answer").value.trim();
  const explanation =
    document.getElementById("explanation").value.trim();

  if (!question || !answer) {
    alert("問題文と正解は必須です");
    return;
  }

  const wrongs = [];
  document.querySelectorAll(".choice-row").forEach(row => {
    const check = row.querySelector("input[type='checkbox']");
    const text = row.querySelector("input[type='text']").value.trim();
    if (check.checked && text) {
      wrongs.push(text);
    }
  });

  if (wrongs.length < 3) {
    alert("不正解を3つ以上チェックしてください");
    return;
  }

  const choices =
    [answer, ...wrongs.slice(0,3)]
    .sort(() => Math.random() - 0.5);

  const data =
    JSON.parse(localStorage.getItem("questions")) || [];

  data.push({
    id: crypto.randomUUID(),
    question,
    choices,
    answer,
    explanation: explanation || ""
  });

  localStorage.setItem("questions", JSON.stringify(data));

  alert("保存しました");
  location.href = "index.html";
}
</script>

</body>
</html>
