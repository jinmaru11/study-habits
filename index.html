<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Habits</title>

<style>
body{
  margin:0;
  background:#f4f4f4;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
}
header{
  background:#b00020;
  color:white;
  padding:16px;
  text-align:center;
  font-weight:bold;
}
main{
  max-width:600px;
  margin:auto;
  padding:16px;
}
.card{
  background:white;
  padding:16px;
  border-radius:12px;
  margin-bottom:16px;
}

/* ===== ãƒœã‚¿ãƒ³ ===== */
.actions{
  display:flex;
  gap:12px;
  margin-bottom:16px;
}
.actions button{
  flex:1;
  padding:14px;
  border:none;
  border-radius:10px;
  font-size:16px;
  color:white;
}
.solve{ background:#b00020; }
.add{ background:#555; }

/* ===== ã‚¹ãƒˆãƒªãƒ¼ã‚¯ ===== */
.streak{
  font-size:18px;
  font-weight:bold;
  color:#ff5722;
}

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ===== */
.calendar-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  margin-bottom:8px;
}
.month-area{
  display:flex;
  align-items:center;
  gap:8px;
}
.month-btn{
  border:none;
  background:#b00020;
  color:white;
  width:32px;
  height:32px;
  border-radius:50%;
}
.today-btn{
  border:none;
  background:#eee;
  padding:6px 12px;
  border-radius:8px;
  font-size:13px;
}
#calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  text-align:center;
}
.cal-cell{
  height:40px;
  border-radius:8px;
  background:#eee;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
}
.today{
  border:2px solid #b00020;
  background:white;
  font-weight:bold;
}

/* ===== å‰äººã‚«ãƒ¼ãƒ‰ ===== */
.hero{
  padding:12px;
  border-radius:10px;
  margin-top:8px;
}
.common{ background:#e0e0e0; }
.rare{ background:#8ecae6; }
.legendary{
  background:linear-gradient(135deg,#ffd700,#fff5b7,#ffd700);
}
.hero-name{
  font-weight:bold;
}
.hero-job{
  font-size:12px;
  opacity:0.8;
}
</style>
</head>

<body>

<header>Study Habits</header>

<main>

<!-- æˆé•·ã‚¹ã‚³ã‚¢ -->
<section class="card">
  <div>æˆé•·ã‚¹ã‚³ã‚¢</div>
  <div id="score" style="font-size:32px;color:#b00020;">1.00</div>
</section>

<!-- ã‚¹ãƒˆãƒªãƒ¼ã‚¯ -->
<section class="card">
  <div>é€£ç¶šå­¦ç¿’ã‚¹ãƒˆãƒªãƒ¼ã‚¯</div>
  <div class="streak" id="streak">ğŸ”¥ 0 æ—¥</div>
</section>

<!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="actions">
  <button class="solve" onclick="location.href='quiz.html'">å•é¡Œã‚’è§£ã</button>
  <button class="add" onclick="location.href='add.html'">å•é¡Œã‚’è¿½åŠ </button>
</div>

<!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
<section class="card">
  <div class="calendar-header">
    <button class="month-btn" onclick="prevMonth()">â€¹</button>

    <div class="month-area">
      <div id="monthTitle"></div>
      <button class="today-btn" onclick="goToday()">ä»Šæ—¥</button>
    </div>

    <button class="month-btn" onclick="nextMonth()">â€º</button>
  </div>
  <div id="calendar"></div>
</section>

<!-- å‰äººã‚«ãƒ¼ãƒ‰ -->
<section class="card">
  <div style="font-weight:bold;margin-bottom:8px;">ç²å¾—ã—ãŸå‰äººã‚«ãƒ¼ãƒ‰</div>
  <div id="heroes"></div>
</section>

</main>

<script>
/* ===== æˆé•·ã‚¹ã‚³ã‚¢ ===== */
document.getElementById("score").textContent =
  (parseFloat(localStorage.getItem("growthScore"))||1).toFixed(2);

/* ===== ã‚¹ãƒˆãƒªãƒ¼ã‚¯ ===== */
function calcStreak(){
  const h=JSON.parse(localStorage.getItem("studyHistory"))||{};
  let d=new Date(),s=0;
  while(true){
    const k=d.toISOString().slice(0,10);
    if(h[k]){ s++; d.setDate(d.getDate()-1); }
    else break;
  }
  return s;
}
document.getElementById("streak").textContent =
  `ğŸ”¥ ${calcStreak()} æ—¥`;

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ===== */
let y,m;
const now=new Date();
y=now.getFullYear();
m=now.getMonth();

function render(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  document.getElementById("monthTitle").textContent=`${y}å¹´ ${m+1}æœˆ`;

  const hist=JSON.parse(localStorage.getItem("studyHistory"))||{};
  const today=new Date().toISOString().slice(0,10);

  ["æ—¥","æœˆ","ç«","æ°´","æ°´","é‡‘","åœŸ"].forEach(d=>{
    const e=document.createElement("div");
    e.textContent=d;
    e.style.fontWeight="bold";
    cal.appendChild(e);
  });

  const fd=new Date(y,m,1).getDay();
  const ld=new Date(y,m+1,0).getDate();

  for(let i=0;i<fd;i++) cal.appendChild(document.createElement("div"));

  for(let d=1;d<=ld;d++){
    const key=`${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const c=document.createElement("div");
    c.className="cal-cell";
    c.textContent=hist[key]?"â­ï¸":d;
    if(key===today) c.classList.add("today");
    cal.appendChild(c);
  }
}

function prevMonth(){
  m--;
  if(m<0){m=11;y--;}
  render();
}
function nextMonth(){
  m++;
  if(m>11){m=0;y++;}
  render();
}
function goToday(){
  const t=new Date();
  y=t.getFullYear();
  m=t.getMonth();
  render();
}
render();

/* ===== å‰äººã‚«ãƒ¼ãƒ‰ ===== */
const heroes=
  JSON.parse(localStorage.getItem("heroCards"))||[];
const box=document.getElementById("heroes");

if(heroes.length===0){
  box.textContent="ã¾ã ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“";
}else{
  heroes.forEach(h=>{
    const d=document.createElement("div");
    d.className=`hero ${h.rarity}`;
    d.innerHTML=`
      <div class="hero-name">${h.name}</div>
      <div class="hero-job">${h.job}</div>
    `;
    box.appendChild(d);
  });
}
</script>

</body>
</html>
