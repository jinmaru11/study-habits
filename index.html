<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Habits</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#b30000">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f4f4f4;
}
header {
  background: #b30000;
  color: white;
  text-align: center;
  padding: 16px;
  font-size: 20px;
  font-weight: bold;
}
.card {
  background: white;
  margin: 12px;
  padding: 16px;
  border-radius: 12px;
}
.choice {
  background: #eee;
  margin-top: 6px;
  padding: 10px;
  border-radius: 8px;
}
button {
  width: 100%;
  padding: 14px;
  margin: 12px;
  border: none;
  border-radius: 10px;
  background: #b30000;
  color: white;
  font-size: 16px;
}
.score {
  font-size: 28px;
  color: #b30000;
}
  .calendar-cell {
  height: 44px;
  border-radius: 8px;
  background: #fafafa;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
}

.calendar-cell {
  padding: 8px;
  border-radius: 8px;
  background: #f5f5f5;
}

.calendar-cell.today {
  border: 2px solid #b00020;
  font-weight: bold;
  background: #fff;
}

.calendar-star {
  font-size: 18px;
}

.calendar-header {
  display: grid;
  grid-template-columns: 40px 1fr 40px;
  align-items: center;
  margin-bottom: 12px;
}

.calendar-center {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å°‚ç”¨ãƒœã‚¿ãƒ³ã®ä¸Šæ›¸ã ===== */
.calendar-header button {
  width: auto;        /* â† 100% ã‚’ç„¡åŠ¹åŒ– */
  margin: 0;          /* â† ä½™è¨ˆãªã‚ºãƒ¬é˜²æ­¢ */
  padding: 0;
}
  
/* å·¦å³ãƒœã‚¿ãƒ³ã‚’ç«¯ã«å›ºå®š */
.month-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: #b00020;.calendar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.month-btn {
  width: 36px;
  height: 36px;
  padding: 0;
  border-radius: 50%;
  background: #b00020;
  color: white;
  font-size: 18px;
  font-weight: bold;
  border: none;
}

.calendar-title {
  font-size: 20px;
  font-weight: bold;
  white-space: nowrap;   /* â† æ”¹è¡Œã•ã›ãªã„ */
}  

#calendar {
  min-height: 300px;   /* å¥½ããªé«˜ã•ã§OKï¼ˆä¾‹ï¼‰ */
}

.today-btn {
  min-width: 72px;          /* â† æ¨ªå¹…ã‚’ç¢ºä¿ï¼ˆã“ã“ã‚’èª¿æ•´ï¼‰ */
  padding: 6px 14px;  
  font-size: 12px;
  border-radius: 8px;
  border: 3px solid #b00020;
  background: white;
  color: #b00020;
  font-weight: bold;
  white-space: nowrap;
}
 
</style>
</head>

<body>

<header style="background:#b00020;color:white;padding:16px;text-align:center;">
  <h1>Study Habits</h1>
</header>

<main style="padding:16px;max-width:600px;margin:auto;">

  <!-- æˆé•·ã‚¹ã‚³ã‚¢ -->
  <section style="background:#fff;padding:16px;border-radius:12px;margin-bottom:16px;">
    <div>ç¾åœ¨ã®æˆé•·ã‚¹ã‚³ã‚¢</div>
    <div id="currentScore" style="font-size:32px;color:#b00020;">1.00</div>
    <div>éå»æœ€é«˜ï¼š<span id="maxScore">1.00</span></div>
    <div id="secretaryMessage" style="margin-top:8px;font-size:14px;color:#b00020;"></div>
  </section>

  <!-- é€£ç¶šå­¦ç¿’ã‚¹ãƒˆãƒªãƒ¼ã‚¯ -->
<section class="card">
  <div style="font-size:14px;color:#666;">é€£ç¶šå­¦ç¿’ã‚¹ãƒˆãƒªãƒ¼ã‚¯</div>
  <div id="streakCount"
       style="font-size:28px;
              font-weight:bold;
              color:#ff5722;">
    ğŸ”¥ 0 æ—¥
  </div>
</section>
  
  <!-- å­¦ç¿’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->  
<section class="card">
  <div class="calendar-header">
   <button class="month-btn left" onclick="prevMonth()">â€¹</button>

   <div class="calendar-center">
    <span id="calendarTitle" class="calendar-title">2026å¹´1æœˆ</span>
    <button class="today-btn" onclick="goToday()">æœ¬æ—¥</button>
   </div>

   <button class="month-btn right" onclick="nextMonth()">â€º</button>
  </div>

ã€€</div>

  <div id="calendar"
       style="display:grid;
              grid-template-columns:repeat(7,1fr);
              gap:6px;
              text-align:center;">
  </div>

</section>
  
<button onclick="goToQuiz()"
        style="
          width:100%;
          padding:16px;
          font-size:18px;
          background:#b00020;
          color:white;
          border:none;
          border-radius:12px;
          margin-bottom:16px;
        ">
  å•é¡Œã‚’è§£ã
</button>
  
  <section id="quizScreen"
         style="background:#fff;
                padding:16px;
                border-radius:12px;
                margin-bottom:16px;
                display:none;">
  
  <div id="questionText"
       style="font-size:18px;margin-bottom:12px;">
    å•é¡ŒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
  </div>
    
  <div id="choices"
       style="display:flex;flex-direction:column;gap:8px;">
  </div>

  <div style="display:flex; gap:12px; padding:16px;">
  <button onclick="location.href='quiz.html'"
    style="flex:1; padding:16px; font-size:18px;
           background:#b00020; color:white;
           border:none; border-radius:12px;">
    å•é¡Œã‚’è§£ã
  </button>

  <button onclick="location.href='add.html'"
    style="flex:1; padding:16px; font-size:18px;
           background:#555; color:white;
           border:none; border-radius:12px;">
    å•é¡Œã‚’è¿½åŠ 
  </button>
</div>

  <button onclick="nextQuestion()"
    style="width:100%;
           padding:16px;
           font-size:18px;
           background:#b00020;
           color:white;
           border:none;
           border-radius:12px;
           margin-top:12px;">
    æ¬¡ã¸
  </button>
  
</main>

<script>
// ===== è¡¨ç¤ºä¸­ã®å¹´æœˆ =====
let currentYear;
let currentMonth;

function initCalendarDate() {
  const now = new Date();
  currentYear = now.getFullYear();
  currentMonth = now.getMonth(); // 0-11
} 
  
  /* ========= ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”» ========= */
function renderCalendar(year, month) {
  const calendar = document.getElementById("calendar");
  if (!calendar) return;

  calendar.innerHTML = "";

  const studyHistory =
    JSON.parse(localStorage.getItem("studyHistory")) || {};

  const today = new Date();
  const todayStr = today.toISOString().slice(0,10);

  // ã‚¿ã‚¤ãƒˆãƒ«
  document.getElementById("calendarTitle").textContent =
    `${year}å¹´ ${month + 1}æœˆ`;

  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month + 1, 0).getDate();

  // æ›œæ—¥
  ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].forEach(d => {
    const h = document.createElement("div");
    h.textContent = d;
    h.style.fontWeight = "bold";
    calendar.appendChild(h);
  });

  // ç©ºç™½
  for (let i = 0; i < firstDay; i++) {
    calendar.appendChild(document.createElement("div"));
  }

  // æ—¥ä»˜
  for (let d = 1; d <= lastDate; d++) {
    const dateStr =
      `${year}-${String(month + 1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;

    const cell = document.createElement("div");
    cell.className = "calendar-cell";

    if (studyHistory[dateStr]) {
      cell.textContent = "â­ï¸";
      cell.style.background = "#ffe082";
    } else {
      cell.textContent = d;
    }

    if (dateStr === todayStr) {
      cell.classList.add("today");
    }

    calendar.appendChild(cell);
  }
 
  // ===== 6é€±ï¼ˆ42æ—¥ï¼‰ã«å›ºå®š =====
ã€€const totalCellsNow = calendar.children.length;

// æ›œæ—¥7 + æ—¥ä»˜42 = 49
ã€€for (let i = totalCellsNow; i < 49; i++) {
  calendar.appendChild(document.createElement("div"));
ã€€}
} 
  
function goToday() {
  const now = new Date();
  currentYear = now.getFullYear();
  currentMonth = now.getMonth(); // 0-11
  renderCalendar(currentYear, currentMonth);
}
  
function updateTodayButton() {
  const btn = document.querySelector(".today-btn");
  const now = new Date();
  if (
    currentYear === now.getFullYear() &&
    currentMonth === now.getMonth()
  ) {
    btn.style.display = "none";
  } else {
    btn.style.display = "inline-block";
  }
}
  
function calculateStreak() {
  const history =
    JSON.parse(localStorage.getItem("studyHistory")) || {};

  // é€£ç¶šæ—¥æ•°
  let streak = 0;
  let date = new Date();

  while (true) {
    const key = date.toISOString().slice(0,10);
    if (history[key]) {
      streak++;
      date.setDate(date.getDate() - 1);
    } else {
      break;
    }
  }

  return streak;
}
  
const streak = calculateStreak();
document.getElementById("streakCount").textContent =
  `ğŸ”¥ ${streak} æ—¥`;
  
const today = new Date().toISOString().slice(0,10);
const lastStudyDate = localStorage.getItem("lastStudyDate");

if (lastStudyDate && lastStudyDate !== today) {
  localStorage.setItem("growthScore", 0);
  growthScore = 0;
}
  
/* ========= åˆæœŸè¨­å®š ========= */
let questions = JSON.parse(localStorage.getItem("questions")) || [
  {
    question: "Study Habitsã¯ä½•ã‚’ç›®çš„ã¨ã—ãŸã‚¢ãƒ—ãƒªï¼Ÿ",
    choices: [
      "å­¦ç¿’ã‚’ç¿’æ…£åŒ–ã—æˆé•·ã‚’å¯è¦–åŒ–ã™ã‚‹",
      "SNSã§å‹‰å¼·ä»²é–“ã‚’æ¢ã™",
      "è³‡æ ¼è©¦é¨“ã‚’ä»£è¡Œã™ã‚‹",
      "å‹•ç”»ã‚’è¦‹ã‚‹ãŸã‚"
    ],
    answer: "å­¦ç¿’ã‚’ç¿’æ…£åŒ–ã—æˆé•·ã‚’å¯è¦–åŒ–ã™ã‚‹",
     explanation: "æ¯æ—¥ã®å¾©ç¿’ã‚’é€šã˜ã¦ã€å­¦ã³ã‚’ç¿’æ…£åŒ–ã—ã€æˆé•·ã‚’æ•°å€¤ã§å®Ÿæ„Ÿã™ã‚‹ãŸã‚ã®ã‚¢ãƒ—ãƒªã§ã™ã€‚"
  }
];

let todayAnswered = false;
let currentQuestionIndex = 0;

/* ========= å­¦ç¿’å±¥æ­´ ========= */
let studyHistory = JSON.parse(localStorage.getItem("studyHistory")) || {};
  
/* ========= ç§˜æ›¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ========= */
const secretaryMessages = [
  "ç§˜æ›¸ã‚ˆã‚Šï¼šéå»æœ€é«˜ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚ç´ æ™´ã‚‰ã—ã„ç¶™ç¶šã§ã™ã€‚",
  "ç§˜æ›¸ã‚ˆã‚Šï¼šåŠªåŠ›ãŒæ•°å­—ã«è¡¨ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®èª¿å­ã§ã™ã€‚",
  "ç§˜æ›¸ã‚ˆã‚Šï¼šä»Šå¹´ã¯äººç”Ÿã§ä¸€ç•ªæˆé•·ã—ã¦ã„ã‚‹å¹´ã«ãªã£ã¦ã„ã¾ã™ã€‚",
  "ç§˜æ›¸ã‚ˆã‚Šï¼šç€å®Ÿã«ç©ã¿ä¸ŠãŒã£ã¦ã„ã¾ã™ã€‚ã¨ã¦ã‚‚è‰¯ã„æµã‚Œã§ã™ã€‚"
];
  
/* ========= æˆé•·ã‚¹ã‚³ã‚¢ ========= */
let growthScore = parseFloat(localStorage.getItem("growthScore")) || 1.0;
let maxScore = parseFloat(localStorage.getItem("maxScore")) || 1.0;

document.getElementById("currentScore").textContent = growthScore.toFixed(2);
document.getElementById("maxScore").textContent = maxScore.toFixed(2);

/* ========= ã‚·ãƒ£ãƒƒãƒ•ãƒ« ========= */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

/* ========= å‡ºé¡Œ ========= */
let dailyQuestions = [...questions];
shuffle(dailyQuestions);
dailyQuestions = dailyQuestions.slice(0, 20);

function showQuestion() {
  if (currentQuestionIndex >= dailyQuestions.length) {
    completeToday();
    return;
  }

  const q = dailyQuestions[currentQuestionIndex];
  document.getElementById("questionText").textContent = q.question;

  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";

  q.choices.forEach(choice => {
    const btn = document.createElement("button");
    btn.textContent = choice;
    btn.className = "choice-btn";
    btn.onclick = () => selectAnswer(choice, q.answer);
    choicesDiv.appendChild(btn);
  });
}

/* ========= å›ç­” ========= */
function selectAnswer(selected, correct) {
  const buttons = document.querySelectorAll(".choice-btn");
  buttons.forEach(btn => {
    btn.disabled = true;
    if (btn.textContent === correct) btn.style.background = "#4CAF50";
    if (btn.textContent === selected && selected !== correct) {
      btn.style.background = "#f44336";
    }
  });

  // è§£èª¬è¡¨ç¤º
  const explanationDiv = document.createElement("div");
  explanationDiv.style.marginTop = "12px";
  explanationDiv.style.padding = "12px";
  explanationDiv.style.background = "#f9f9f9";
  explanationDiv.style.borderRadius = "8px";
  explanationDiv.style.fontSize = "14px";
  explanationDiv.innerHTML =
    `<strong>æ­£è§£ï¼š</strong>${correct}<br><br>` +
    dailyQuestions[currentQuestionIndex].explanation;

  document.getElementById("choices").appendChild(explanationDiv);
}

/* ========= æ¬¡ã¸ ========= */
function nextQuestion() {
  currentQuestionIndex++;
  showQuestion();
}

/* ========= ä»Šæ—¥é”æˆ ========= */
function completeToday() {
  if (!todayAnswered) {

    const oldBest = maxScore; // ã“ã‚Œã¾ã§ã®æœ€é«˜

    // æˆé•·ã‚¹ã‚³ã‚¢æ›´æ–°ï¼ˆè¤‡åˆ©ï¼‰
    growthScore = growthScore * 1.0101;

    let isNewRecord = false;
    if (growthScore > maxScore) {
      maxScore = growthScore;
      isNewRecord = true;
    }

    localStorage.setItem("growthScore", growthScore);
    localStorage.setItem("maxScore", maxScore);

    todayAnswered = true;
    // ä»Šæ—¥ã®æ—¥ä»˜ã‚­ãƒ¼
const todayKey = new Date().toISOString().slice(0,10);

// â­ï¸ ä¿å­˜
studyHistory[todayKey] = true;
localStorage.setItem("studyHistory", JSON.stringify(studyHistory));

// â­ï¸ ã‚¹ãƒˆãƒªãƒ¼ã‚¯  
const streak = calculateStreak();
document.getElementById("streakCount").textContent =
  `ğŸ”¥ ${streak} æ—¥`;

    // è¡¨ç¤ºæ›´æ–°
    document.getElementById("currentScore").textContent = growthScore.toFixed(2);
    document.getElementById("maxScore").textContent = maxScore.toFixed(2);

    // â‘£ã¸åˆ†å²
    if (isNewRecord) {
      celebrateRecord();
    } else {
      document.getElementById("secretaryMessage").textContent =
        "ç§˜æ›¸ã‚ˆã‚Šï¼šæœ¬æ—¥ã®å­¦ç¿’ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚";
    }
  }

  setTimeout(() => {
    location.reload();
  }, 800);
}
  
/* ========= è¨˜éŒ²æ›´æ–°æ¼”å‡º ========= */
function celebrateRecord() {
  const msg =
    secretaryMessages[Math.floor(Math.random() * secretaryMessages.length)];

  // ç§˜æ›¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
  document.getElementById("secretaryMessage").textContent = msg;

  // èƒŒæ™¯ã‚’ä¸€ç¬ã ã‘ç¥ç¦è‰²ã«
  document.body.style.background = "#fff5f5";

  // è»½ã„ç¥ç¦ãƒãƒƒãƒ—
  setTimeout(() => {
    alert("ğŸ”¥ éå»æœ€é«˜ã‚¹ã‚³ã‚¢æ›´æ–°ï¼");
  }, 300);
}
  
/* ========= åˆå›è¡¨ç¤º ========= */
showQuestion();

function prevMonth() {
  currentMonth--;
  if (currentMonth < 0) {
    currentMonth = 11;
    currentYear--;
  }
  renderCalendar(currentYear, currentMonth);
}

function nextMonth() {
  currentMonth++;
  if (currentMonth > 11) {
    currentMonth = 0;
    currentYear++;
  }
  renderCalendar(currentYear, currentMonth);
}
  
// ===== ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œ =====
let startX = 0;
const calendarArea = document.getElementById("calendar");

calendarArea.addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
});

calendarArea.addEventListener("touchend", e => {
  const diff = e.changedTouches[0].clientX - startX;

  if (diff > 50) prevMonth();
  if (diff < -50) nextMonth();
});

// ===== åˆå›è¡¨ç¤º =====
initCalendarDate();
renderCalendar(currentYear, currentMonth);  

function startQuiz() {
  // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å´ã‚’éš ã™
  document.getElementById("startQuizBtn").style.display = "none";

  // å•é¡Œç”»é¢ã‚’è¡¨ç¤º
  document.getElementById("quizScreen").style.display = "block";
}

function goToQuiz() {
  window.location.href = "quiz.html";
}
  
</script>
  
</body>
</html>
