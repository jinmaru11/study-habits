<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Habits</title>

<style>
body{
  margin:0;
  background:#f4f4f4;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
}
header{
  background:#b00020;
  color:white;
  padding:16px;
  text-align:center;
  font-weight:bold;
}
main{
  max-width:600px;
  margin:auto;
  padding:16px;
}
.card{
  background:white;
  padding:16px;
  border-radius:12px;
  margin-bottom:16px;
}

/* ===== ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ ===== */
.actions{
  display:flex;
  gap:12px;
  margin-bottom:16px;
  flex-wrap:wrap;
}
.actions button{
  flex:1;
  padding:14px;
  border:none;
  border-radius:10px;
  font-size:16px;
  color:white;
}
.solve{ background:#b00020; }
.add{ background:#555; }
.edit{ background:#555; }

/* ===== ã‚¹ãƒˆãƒªãƒ¼ã‚¯ ===== */
.streak{
  font-size:18px;
  font-weight:bold;
  color:#ff5722;
}

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ===== */
.calendar-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  margin-bottom:8px;
}
.month-area{
  display:flex;
  align-items:center;
  gap:8px;
}
.month-btn{
  border:none;
  background:#b00020;
  color:white;
  width:32px;
  height:32px;
  border-radius:50%;
}
.today-btn{
  border:none;
  background:#eee;
  padding:6px 12px;
  border-radius:8px;
  font-size:13px;
}
#calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  text-align:center;
}
.cal-cell{
  height:40px;
  border-radius:8px;
  background:#eee;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
}
.today{
  border:2px solid #b00020;
  background:white;
  font-weight:bold;
}
</style>
</head>

<body>

<header>Study Habits</header>

<main>

<section class="card">
  <div>æˆé•·ã‚¹ã‚³ã‚¢</div>
  <div id="score" style="font-size:32px;color:#b00020;">1.00</div>
</section>

<section class="card">
  <div>é€£ç¶šå­¦ç¿’ã‚¹ãƒˆãƒªãƒ¼ã‚¯</div>
  <div class="streak" id="streak">ğŸ”¥ 0 æ—¥</div>
</section>

<div class="actions">
  <button class="solve" onclick="location.href='quiz.html'">å•é¡Œã‚’è§£ã</button>
  <button class="add" onclick="location.href='add.html'">å•é¡Œã‚’è¿½åŠ </button>
  <button class="edit" onclick="location.href='edit.html'">å•é¡Œã‚’ç·¨é›†</button>
</div>

<section class="card">
  <div class="calendar-header">
    <button class="month-btn" onclick="prevMonth()">â€¹</button>
    <div class="month-area">
      <div id="monthTitle"></div>
      <button class="today-btn" onclick="goToday()">ä»Šæ—¥</button>
    </div>
    <button class="month-btn" onclick="nextMonth()">â€º</button>
  </div>
  <div id="calendar"></div>
</section>

</main>

<script>
/* ===== æˆé•·ã‚¹ã‚³ã‚¢ï¼šæœªå­¦ç¿’ãƒªã‚»ãƒƒãƒˆåˆ¤å®š ===== */
(function normalizeGrowth(){
  const today = new Date();
  const last = localStorage.getItem("lastStudyDate");
  if(!last) return;

  const lastDate = new Date(last);
  const diff =
    Math.floor((today - lastDate) / (1000*60*60*24));

  if(diff > 1){
    localStorage.setItem("growthScore", 1);
  }
})();

/* ===== æˆé•·ã‚¹ã‚³ã‚¢è¡¨ç¤º ===== */
document.getElementById("score").textContent =
  (parseFloat(localStorage.getItem("growthScore"))||1).toFixed(2);

/* ===== ã‚¹ãƒˆãƒªãƒ¼ã‚¯ ===== */
function calcStreak(){
  const h=JSON.parse(localStorage.getItem("studyHistory"))||{};
  let d=new Date(),s=0;
  while(true){
    const k=d.toISOString().slice(0,10);
    if(h[k]){ s++; d.setDate(d.getDate()-1); }
    else break;
  }
  return s;
}
document.getElementById("streak").textContent =
  `ğŸ”¥ ${calcStreak()} æ—¥`;

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ===== */
let y,m;
const now=new Date();
y=now.getFullYear();
m=now.getMonth();

function render(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  document.getElementById("monthTitle").textContent=`${y}å¹´ ${m+1}æœˆ`;

  const hist=JSON.parse(localStorage.getItem("studyHistory"))||{};
  const today=new Date().toISOString().slice(0,10);

  ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].forEach(d=>{
    const e=document.createElement("div");
    e.textContent=d;
    e.style.fontWeight="bold";
    cal.appendChild(e);
  });

  const fd=new Date(y,m,1).getDay();
  const ld=new Date(y,m+1,0).getDate();

  for(let i=0;i<fd;i++) cal.appendChild(document.createElement("div"));

  for(let d=1;d<=ld;d++){
    const key=`${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const c=document.createElement("div");
    c.className="cal-cell";
    c.textContent=hist[key]?"â­ï¸":d;
    if(key===today) c.classList.add("today");
    cal.appendChild(c);
  }
}
function prevMonth(){ m--; if(m<0){m=11;y--;} render(); }
function nextMonth(){ m++; if(m>11){m=0;y++;} render(); }
function goToday(){ const t=new Date(); y=t.getFullYear(); m=t.getMonth(); render(); }
render();
</script>

</body>
</html>
