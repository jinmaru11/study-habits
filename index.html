<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Habits</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f4f4f4;
}

header {
  background: #b00020;
  color: white;
  padding: 16px;
  text-align: center;
  font-size: 20px;
  font-weight: bold;
}

main {
  padding: 16px;
  max-width: 600px;
  margin: auto;
}

.card {
  background: white;
  margin-bottom: 16px;
  padding: 16px;
  border-radius: 12px;
}

/* ===== ãƒœã‚¿ãƒ³ ===== */
button {
  width: 100%;
  padding: 16px;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  background: #b00020;
  color: white;
}

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ===== */
.calendar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.month-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: #b00020;
  color: white;
  font-size: 18px;
  font-weight: bold;
  border: none;
}

.calendar-center {
  display: flex;
  align-items: center;
  gap: 10px;
}

.calendar-title {
  font-size: 22px;
  font-weight: bold;
  white-space: nowrap;
}

.today-btn {
  min-width: 72px;
  padding: 6px 14px;
  font-size: 12px;
  border-radius: 8px;
  border: 3px solid #b00020;
  background: white;
  color: #b00020;
  font-weight: bold;
  white-space: nowrap;
}

#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
  text-align: center;
  min-height: 300px;
}

.calendar-cell {
  height: 44px;
  border-radius: 8px;
  background: #f5f5f5;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
}

.calendar-cell.today {
  border: 2px solid #b00020;
  font-weight: bold;
  background: #fff;
}
</style>
</head>

<body>

<header>Study Habits</header>

<main>

  <!-- æˆé•·ã‚¹ã‚³ã‚¢ -->
  <section class="card">
    <div>ç¾åœ¨ã®æˆé•·ã‚¹ã‚³ã‚¢</div>
    <div id="currentScore" style="font-size:32px;color:#b00020;">1.00</div>
    <div>éå»æœ€é«˜ï¼š<span id="maxScore">1.00</span></div>
  </section>

  <!-- ã‚¹ãƒˆãƒªãƒ¼ã‚¯ -->
  <section class="card">
    <div style="font-size:14px;color:#666;">é€£ç¶šå­¦ç¿’ã‚¹ãƒˆãƒªãƒ¼ã‚¯</div>
    <div id="streakCount"
         style="font-size:28px;font-weight:bold;color:#ff5722;">
      ğŸ”¥ 0 æ—¥
    </div>
  </section>

  <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
  <section class="card">
    <div class="calendar-header">
      <button class="month-btn" onclick="prevMonth()">â€¹</button>

      <div class="calendar-center">
        <span id="calendarTitle" class="calendar-title"></span>
        <button class="today-btn" onclick="goToday()">æœ¬æ—¥</button>
      </div>

      <button class="month-btn" onclick="nextMonth()">â€º</button>
    </div>

    <div id="calendar"></div>
  </section>

  <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div style="display:flex; gap:12px;">
    <button onclick="location.href='quiz.html'" style="flex:1;">
      å•é¡Œã‚’è§£ã
    </button>
    <button onclick="location.href='add.html'"
            style="flex:1;background:#555;">
      å•é¡Œã‚’è¿½åŠ 
    </button>
  </div>

</main>

<script>
/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ===== */
let currentYear, currentMonth;

function initCalendarDate() {
  const now = new Date();
  currentYear = now.getFullYear();
  currentMonth = now.getMonth();
}

function renderCalendar(year, month) {
  const calendar = document.getElementById("calendar");
  calendar.innerHTML = "";

  const history =
    JSON.parse(localStorage.getItem("studyHistory")) || {};

  const today = new Date().toISOString().slice(0,10);

  document.getElementById("calendarTitle").textContent =
    `${year}å¹´ ${month + 1}æœˆ`;

  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month + 1, 0).getDate();

  ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].forEach(d => {
    const el = document.createElement("div");
    el.textContent = d;
    el.style.fontWeight = "bold";
    calendar.appendChild(el);
  });

  for (let i = 0; i < firstDay; i++) {
    calendar.appendChild(document.createElement("div"));
  }

  for (let d = 1; d <= lastDate; d++) {
    const key =
      `${year}-${String(month+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const cell = document.createElement("div");
    cell.className = "calendar-cell";

    cell.textContent = history[key] ? "â­ï¸" : d;
    if (key === today) cell.classList.add("today");

    calendar.appendChild(cell);
  }

  while (calendar.children.length < 49) {
    calendar.appendChild(document.createElement("div"));
  }
  updateTodayButton();  
}

function prevMonth() {
  currentMonth--;
  if (currentMonth < 0) {
    currentMonth = 11;
    currentYear--;
  }
  renderCalendar(currentYear, currentMonth);
}

function nextMonth() {
  currentMonth++;
  if (currentMonth > 11) {
    currentMonth = 0;
    currentYear++;
  }
  renderCalendar(currentYear, currentMonth);
}

function goToday() {
  initCalendarDate();
  renderCalendar(currentYear, currentMonth);
  updateTodayButton();
}
  
function updateTodayButton() {
  const btn = document.querySelector(".today-btn");
  const now = new Date();

  if (
    currentYear === now.getFullYear() &&
    currentMonth === now.getMonth()
  ) {
    btn.style.display = "none";
  } else {
    btn.style.display = "inline-block";
  }
}

/* ===== ã‚¹ãƒˆãƒªãƒ¼ã‚¯ ===== */
function calculateStreak() {
  const history =
    JSON.parse(localStorage.getItem("studyHistory")) || {};
  let streak = 0;
  let date = new Date();

  while (true) {
    const key = date.toISOString().slice(0,10);
    if (history[key]) {
      streak++;
      date.setDate(date.getDate() - 1);
    } else break;
  }
  return streak;
}

/* ===== åˆæœŸè¡¨ç¤º ===== */
initCalendarDate();
renderCalendar(currentYear, currentMonth);

document.getElementById("streakCount").textContent =
  `ğŸ”¥ ${calculateStreak()} æ—¥`;

const growthScore =
  parseFloat(localStorage.getItem("growthScore")) || 1.0;
const maxScore =
  parseFloat(localStorage.getItem("maxScore")) || 1.0;

document.getElementById("currentScore").textContent =
  growthScore.toFixed(2);
document.getElementById("maxScore").textContent =
  maxScore.toFixed(2);
</script>

</body>
</html>
