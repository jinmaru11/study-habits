<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Habits</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#b30000">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f4f4f4;
}
header {
  background: #b30000;
  color: white;
  text-align: center;
  padding: 16px;
  font-size: 20px;
  font-weight: bold;
}
.card {
  background: white;
  margin: 12px;
  padding: 16px;
  border-radius: 12px;
}
.choice {
  background: #eee;
  margin-top: 6px;
  padding: 10px;
  border-radius: 8px;
}
button {
  width: 100%;
  padding: 14px;
  margin: 12px;
  border: none;
  border-radius: 10px;
  background: #b30000;
  color: white;
  font-size: 16px;
}
.score {
  font-size: 28px;
  color: #b30000;
}
</style>
</head>

<body>

<header style="background:#b00020;color:white;padding:16px;text-align:center;">
  <h1>Study Habits</h1>
</header>

<main style="padding:16px;max-width:600px;margin:auto;">

  <!-- 成長スコア -->
  <section style="background:#fff;padding:16px;border-radius:12px;margin-bottom:16px;">
    <div>現在の成長スコア</div>
    <div id="currentScore" style="font-size:32px;color:#b00020;">1.00</div>
    <div>過去最高：<span id="maxScore">1.00</span></div>
  </section>

  <!-- 問題表示 -->
  <section style="background:#fff;padding:16px;border-radius:12px;margin-bottom:16px;">
    <div id="questionText" style="font-size:18px;margin-bottom:12px;">
      問題がここに表示されます
    </div>

    <div id="choices" style="display:flex;flex-direction:column;gap:8px;">
      <!-- 選択肢ボタンがJSで生成される -->
    </div>
  </section>

  <button onclick="nextQuestion()"
    style="width:100%;padding:16px;font-size:18px;background:#b00020;color:white;border:none;border-radius:12px;">
    次へ
  </button>

</main>

<script>
/* ========= 初期設定 ========= */
let questions = JSON.parse(localStorage.getItem("questions")) || [
  {
    question: "Study Habitsは何を目的としたアプリ？",
    choices: [
      "学習を習慣化し成長を可視化する",
      "SNSで勉強仲間を探す",
      "資格試験を代行する",
      "動画を見るため"
    ],
    answer: "学習を習慣化し成長を可視化する",
     explanation: "毎日の復習を通じて、学びを習慣化し、成長を数値で実感するためのアプリです。"
  }
];

let todayAnswered = false;
let currentQuestionIndex = 0;

/* ========= 成長スコア ========= */
let growthScore = parseFloat(localStorage.getItem("growthScore")) || 1.0;
let maxScore = parseFloat(localStorage.getItem("maxScore")) || 1.0;

document.getElementById("currentScore").textContent = growthScore.toFixed(2);
document.getElementById("maxScore").textContent = maxScore.toFixed(2);

/* ========= シャッフル ========= */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

/* ========= 出題 ========= */
let dailyQuestions = [...questions];
shuffle(dailyQuestions);
dailyQuestions = dailyQuestions.slice(0, 20);

function showQuestion() {
  if (currentQuestionIndex >= dailyQuestions.length) {
    completeToday();
    return;
  }

  const q = dailyQuestions[currentQuestionIndex];
  document.getElementById("questionText").textContent = q.question;

  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";

  q.choices.forEach(choice => {
    const btn = document.createElement("button");
    btn.textContent = choice;
    btn.className = "choice-btn";
    btn.onclick = () => selectAnswer(choice, q.answer);
    choicesDiv.appendChild(btn);
  });
}

/* ========= 回答 ========= */
function selectAnswer(selected, correct) {
  const buttons = document.querySelectorAll(".choice-btn");
  buttons.forEach(btn => {
    btn.disabled = true;
    if (btn.textContent === correct) btn.style.background = "#4CAF50";
    if (btn.textContent === selected && selected !== correct) {
      btn.style.background = "#f44336";
    }
  });

  // 解説表示
  const explanationDiv = document.createElement("div");
  explanationDiv.style.marginTop = "12px";
  explanationDiv.style.padding = "12px";
  explanationDiv.style.background = "#f9f9f9";
  explanationDiv.style.borderRadius = "8px";
  explanationDiv.style.fontSize = "14px";
  explanationDiv.innerHTML =
    `<strong>正解：</strong>${correct}<br><br>` +
    dailyQuestions[currentQuestionIndex].explanation;

  document.getElementById("choices").appendChild(explanationDiv);
}

/* ========= 次へ ========= */
function nextQuestion() {
  currentQuestionIndex++;
  showQuestion();
}

/* ========= 今日達成 ========= */
function completeToday() {
  if (!todayAnswered) {
    growthScore = growthScore * 1.0101;
    maxScore = Math.max(maxScore, growthScore);
    localStorage.setItem("growthScore", growthScore);
    localStorage.setItem("maxScore", maxScore);
    todayAnswered = true;
  }

  alert("本日の学習、完了です。着実に積み上がっています。");
  location.reload();
}

/* ========= 初回表示 ========= */
showQuestion();
</script>
  
</body>
</html>
