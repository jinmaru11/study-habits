<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>問題に挑戦｜Study Habits</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f4f4f4;
}

header {
  background: #b00020;
  color: white;
  text-align: center;
  padding: 16px;
  font-size: 18px;
  font-weight: bold;
}

main {
  padding: 16px;
  max-width: 600px;
  margin: auto;
}

.card {
  background: white;
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 16px;
}

.choice-btn {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  font-size: 16px;
  border: none;
  border-radius: 10px;
  background: #eee;
}

.choice-btn.correct {
  background: #4caf50;
  color: white;
}

.choice-btn.wrong {
  background: #f44336;
  color: white;
}

.explanation {
  margin-top: 12px;
  padding: 12px;
  background: #f9f9f9;
  border-radius: 8px;
  font-size: 14px;
}

button.next-btn {
  width: 100%;
  padding: 16px;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  background: #b00020;
  color: white;
  margin-top: 16px;
}
</style>
</head>

<body>

<header>
  問題に挑戦
  <div id="progress" style="font-size:14px;margin-top:4px;"></div>
</header>

<main>

<section class="card">
  <div id="questionText" style="font-size:18px;font-weight:bold;"></div>
  <div id="choices"></div>
  <div id="explanation" class="explanation" style="display:none;"></div>
</section>

<button class="next-btn" onclick="nextQuestion()">次へ</button>

</main>

<script>
/* ===== 問題取得 ===== */
const stored =
  JSON.parse(localStorage.getItem("questions")) || [];

if (stored.length === 0) {
  alert("問題がまだありません。先に問題を追加してください。");
  location.href = "index.html";
}

/* ===== シャッフル ===== */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

/* ===== 出題準備 ===== */
const TOTAL = 20;
shuffle(stored);
const quizQuestions = stored.slice(0, TOTAL);

let current = 0;
let answered = false;

/* ===== 表示 ===== */
function showQuestion() {
  answered = false;

  const q = quizQuestions[current];
  document.getElementById("questionText").textContent = q.question;
  document.getElementById("progress").textContent =
    `${current + 1} / ${quizQuestions.length}`;

  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";

  q.choices.forEach(choice => {
    const btn = document.createElement("button");
    btn.className = "choice-btn";
    btn.textContent = choice;
    btn.onclick = () => selectAnswer(btn, choice, q.answer, q.explanation);
    choicesDiv.appendChild(btn);
  });

  document.getElementById("explanation").style.display = "none";
}

/* ===== 回答 ===== */
function selectAnswer(btn, selected, correct, explanation) {
  if (answered) return;
  answered = true;

  const buttons = document.querySelectorAll(".choice-btn");

  buttons.forEach(b => {
    b.disabled = true;
    if (b.textContent === correct) b.classList.add("correct");
  });

  if (selected !== correct) {
    btn.classList.add("wrong");
  }

  const exp = document.getElementById("explanation");
  exp.innerHTML =
    `<strong>解説</strong><br>${explanation || "（解説なし）"}`;
  exp.style.display = "block";
}

/* ===== 次へ ===== */
function nextQuestion() {
  if (!answered) {
    alert("回答してください");
    return;
  }

  current++;

  if (current >= quizQuestions.length) {
    completeQuiz();
  } else {
    showQuestion();
  }
}

/* ===== 完了 ===== */
function completeQuiz() {
  alert("本日の問題をすべて解きました！");
  location.href = "index.html";
}

/* ===== 初期表示 ===== */
showQuestion();
</script>

</body>
</html>
