<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>問題に挑戦｜Study Habits</title>

<style>
body{
  margin:0;
  background:#f4f4f4;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
}
header{
  background:#b00020;
  color:white;
  padding:16px;
  text-align:center;
  font-weight:bold;
}
main{
  max-width:600px;
  margin:auto;
  padding:16px;
}
.card{
  background:white;
  padding:16px;
  border-radius:12px;
}
.choice{
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  font-size:16px;
  background:#eee;
}
.correct{ background:#b00020; color:white; }
.wrong{ background:#ccc; color:#333; }

button.next{
  margin-top:16px;
  width:100%;
  padding:16px;
  border:none;
  border-radius:12px;
  font-size:18px;
  background:#b00020;
  color:white;
}

/* ===== 偉人カード演出 ===== */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.hero{
  padding:24px;
  border-radius:16px;
  text-align:center;
  animation:flip 1s;
}
.hero.common{ background:#e0e0e0; }
.hero.rare{ background:#8ecae6; }
.hero.legendary{
  background:linear-gradient(135deg,#ffd700,#fff5b7,#ffd700);
  box-shadow:0 0 20px rgba(255,215,0,0.8);
}
.hero h2{ margin:0; }
.hero p{ margin:6px 0 0; font-size:14px; }

@keyframes flip{
  from{ transform:rotateY(90deg); opacity:0 }
  to{ transform:rotateY(0); opacity:1 }
}
</style>
</head>

<body>

<header>
  問題に挑戦
  <div id="progress" style="font-size:14px;margin-top:4px;"></div>
</header>

<main>

  <div class="card">
    <div id="q" style="font-size:18px;font-weight:bold;"></div>
    <div id="choices"></div>
  </div>

  <button class="next" onclick="next()">次へ</button>
</main>

<script>
/* ===== 問題 ===== */
const raw = localStorage.getItem("questions");
const questions = raw ? JSON.parse(raw) : [];

if(questions.length === 0){
  document.getElementById("q").textContent =
    "⚠ 問題が登録されていません";
}

/* ===== 状態 ===== */
let i = 0;
let answered = false;

/* ===== シャッフル ===== */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

/* ===== 表示 ===== */
function show(){
  answered = false;
  const q = questions[i];

  document.getElementById("q").textContent = q.question;
  document.getElementById("progress").textContent =
    `${i+1} / ${questions.length}`;

  const area = document.getElementById("choices");
  area.innerHTML = "";

  const shuffled = [...q.choices];
  shuffle(shuffled);

  shuffled.forEach(text=>{
    const b = document.createElement("button");
    b.className = "choice";
    b.textContent = text;
    b.onclick = ()=>answer(b, text);
    area.appendChild(b);
  });
}

/* ===== 回答 ===== */
function answer(btn, text){
  if(answered) return;
  answered = true;

  document.querySelectorAll(".choice").forEach(b=>{
    if(b.textContent === questions[i].answer){
      b.classList.add("correct");
    }else if(b === btn){
      b.classList.add("wrong");
    }
    b.disabled = true;
  });
}

/* ===== 次へ ===== */
function next(){
  if(!answered) return alert("回答してください");
  i++;
  if(i >= questions.length){
    finish();
  }else{
    show();
  }
}

/* ===== 終了 ===== */
function finish(){
  alert("本日の学習を完了しました！");
  location.href = "index.html";
}

/* ===== 初期表示 ===== */
if(questions.length > 0){
  show();
}
</script>

</body>
</html>
