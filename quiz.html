<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å•é¡Œã«æŒ‘æˆ¦ï½œStudy Habits</title>

<style>
body{
  margin:0;
  background:#f4f4f4;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
}
header{
  background:#b00020;
  color:white;
  padding:16px;
  text-align:center;
  font-weight:bold;
}
main{
  max-width:600px;
  margin:auto;
  padding:16px;
}
.card{
  background:white;
  padding:16px;
  border-radius:12px;
}
.choice{
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  font-size:16px;
  background:#eee;
}
.correct{ background:#b00020; color:white; }
.wrong{ background:#ccc; color:#333; }

button.next{
  margin-top:16px;
  width:100%;
  padding:16px;
  border:none;
  border-radius:12px;
  font-size:18px;
  background:#b00020;
  color:white;
}
</style>
</head>

<body>

<header>
  å•é¡Œã«æŒ‘æˆ¦
  <div id="progress" style="font-size:14px;margin-top:4px;"></div>
</header>

<main>
  <div class="card">
    <div id="q" style="font-size:18px;font-weight:bold;"></div>
    <div id="choices"></div>
  </div>

  <button class="next" onclick="next()">æ¬¡ã¸</button>
</main>

<script>
/* =====================================================
   æˆé•·ã‚¹ã‚³ã‚¢å–å¾—ï¼ˆåˆæœŸå€¤1ä¿è¨¼ï¼‰
===================================================== */
function getGrowthScore(){
  return Number(localStorage.getItem("growthScore") || 1);
}

/* =====================================================
   å­¦ç¿’è¨˜éŒ² + è¤‡åˆ©ï¼ˆ1æ—¥1å›ï¼‰
===================================================== */
function recordStudy(){
  const today = new Date().toISOString().slice(0,10);

  // å­¦ç¿’å±¥æ­´
  const history = JSON.parse(localStorage.getItem("studyHistory")) || {};
  history[today] = true;
  localStorage.setItem("studyHistory", JSON.stringify(history));

  // æœ€çµ‚å­¦ç¿’æ—¥
  localStorage.setItem("lastStudyDate", today);

  // è¤‡åˆ©ã¯1æ—¥1å›ã®ã¿
  const lastCompound = localStorage.getItem("lastCompoundDate");
  if(lastCompound !== today){
    let score = getGrowthScore();
    score = score * 1.0101; // è¤‡åˆ©
    localStorage.setItem("growthScore", score);
    localStorage.setItem("lastCompoundDate", today);
  }
}

/* =====================================================
   å•é¡Œãƒ‡ãƒ¼ã‚¿
===================================================== */
const raw = localStorage.getItem("questions");
const questions = raw ? JSON.parse(raw) : [];

let i = 0;
let answered = false;

/* =====================================================
   å•é¡Œè¡¨ç¤º
===================================================== */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

function show(){
  answered = false;
  const q = questions[i];

  document.getElementById("q").textContent = q.question;
  document.getElementById("progress").textContent =
    `${i+1} / ${questions.length}`;

  const area = document.getElementById("choices");
  area.innerHTML = "";

  shuffle(q.choices);
  q.choices.forEach(text=>{
    const b = document.createElement("button");
    b.className = "choice";
    b.textContent = text;
    b.onclick = ()=>answer(b);
    area.appendChild(b);
  });
}

/* =====================================================
   å›ç­”å‡¦ç†
===================================================== */
function answer(btn){
  if(answered) return;
  answered = true;

  document.querySelectorAll(".choice").forEach(b=>{
    if(b.textContent === questions[i].answer){
      b.classList.add("correct");
    }else if(b === btn){
      b.classList.add("wrong");
    }
    b.disabled = true;
  });

  // ğŸ”¥ 1å•ã§ã‚‚è§£ã„ãŸã‚‰å­¦ç¿’æˆç«‹
  recordStudy();
}

/* =====================================================
   æ¬¡ã¸ / çµ‚äº†
===================================================== */
function next(){
  if(!answered) return alert("å›ç­”ã—ã¦ãã ã•ã„");

  i++;
  if(i >= questions.length){
    location.href = "index.html";
  }else{
    show();
  }
}

/* =====================================================
   åˆæœŸè¡¨ç¤º
===================================================== */
questions.length
  ? show()
  : document.getElementById("q").textContent = "âš  å•é¡ŒãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“";
</script>

</body>
</html>
