<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å•é¡Œã‚’ç·¨é›†ï½œStudy Habits</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#f4f4f4;
}
header{
  background:#b00020;
  color:#fff;
  padding:16px;
  text-align:center;
  font-weight:600;
}
main{
  max-width:600px;
  margin:auto;
  padding:16px;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
}
label{
  font-size:13px;
  color:#555;
}
input, textarea, select{
  width:100%;
  margin-top:6px;
  margin-bottom:12px;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}
.choice-row{
  display:flex;
  gap:8px;
}
.choice-row input{ flex:1; }
button{
  border:none;
  border-radius:10px;
  padding:12px;
  font-size:15px;
  cursor:pointer;
}
.save{
  background:#b00020;
  color:#fff;
  width:100%;
}
.delete{
  background:#eee;
  color:#333;
  width:100%;
  margin-top:8px;
}

/* ä¸€è¦§ */
.list-item{
  padding:12px;
  border-radius:10px;
  background:#fff;
  margin-bottom:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.list-actions{
  display:flex;
  gap:6px;
}
.edit-btn{
  background:#b00020;
  color:#fff;
  padding:6px 10px;
  font-size:13px;
}
.delete-btn{
  background:#555;
  color:#fff;
  padding:6px 10px;
  font-size:13px;
}

.small{
  font-size:12px;
  color:#777;
}
.controls{
  margin-bottom:12px;
}
.pager{
  display:flex;
  gap:8px;
  justify-content:center;
  margin:12px 0;
}
.pager button{
  background:#eee;
  padding:8px 12px;
}
</style>
</head>

<body>

<header>å•é¡Œã‚’ç·¨é›†</header>

<main>

<!-- ğŸ” æ¤œç´¢ -->
<div class="controls">
  <input id="search" placeholder="å•é¡Œæ–‡ã‚’æ¤œç´¢" oninput="onSearch()">

  <select id="sort" onchange="onSort()">
    <option value="old">è¿½åŠ é †ï¼ˆå¤ã„ â†’ æ–°ã—ã„ï¼‰</option>
    <option value="new">è¿½åŠ é †ï¼ˆæ–°ã—ã„ â†’ å¤ã„ï¼‰</option>
    <option value="az">å•é¡Œæ–‡ A â†’ Z</option>
    <option value="za">å•é¡Œæ–‡ Z â†’ A</option>
  </select>
</div>

<div id="list"></div>

<div class="pager">
  <button onclick="prev()">å‰ã¸</button>
  <button onclick="next()">æ¬¡ã¸</button>
</div>

<!-- âœï¸ ç·¨é›† -->
<div class="card" id="editor" style="display:none">
  <div class="small">ç·¨é›†ä¸­ã®å•é¡Œ</div>

  <label>å•é¡Œæ–‡</label>
  <textarea id="q"></textarea>

  <label>é¸æŠè‚¢ï¼ˆ4æŠï¼‰</label>
  <div id="choices"></div>

  <label>æ­£è§£</label>
  <select id="answer"></select>

  <label>è§£èª¬ï¼ˆä»»æ„ï¼‰</label>
  <textarea id="ex"></textarea>

  <button class="save" onclick="save()">ä¿å­˜</button>
  <button class="delete" onclick="removeQ()">å‰Šé™¤</button>
</div>

</main>

<script>
const PAGE_SIZE = 30;

let questions = JSON.parse(localStorage.getItem("questions")) || [];
let filtered = [...questions];
let page = 0;
let editingIndex = null;

/* ===== æ¤œç´¢ ===== */
function onSearch(){
  const word = document.getElementById("search").value.trim().toLowerCase();
  filtered = questions.filter(q =>
    q.question.toLowerCase().includes(word)
  );
  page = 0;
  onSort(false);
}

/* ===== ä¸¦ã³æ›¿ãˆ ===== */
function onSort(resetPage=true){
  const t = document.getElementById("sort").value;
  let base = [...filtered];

  if(t==="new") base.reverse();
  if(t==="az") base.sort((a,b)=>a.question.localeCompare(b.question,"ja"));
  if(t==="za") base.sort((a,b)=>b.question.localeCompare(a.question,"ja"));

  filtered = base;
  if(resetPage) page = 0;
  render();
}

/* ===== è¡¨ç¤º ===== */
function render(){
  const list = document.getElementById("list");
  list.innerHTML = "";

  const start = page * PAGE_SIZE;
  const slice = filtered.slice(start, start + PAGE_SIZE);

  slice.forEach(q=>{
    const i = questions.indexOf(q);
    const d = document.createElement("div");
    d.className="list-item";
    d.innerHTML=`
      <div>${q.question}</div>
      <div class="list-actions">
        <button class="edit-btn" onclick="edit(${i})">ç·¨é›†</button>
        <button class="delete-btn" onclick="deleteFromList(${i})">å‰Šé™¤</button>
      </div>
    `;
    list.appendChild(d);
  });
}

/* ===== ä¸€è¦§ã‹ã‚‰å‰Šé™¤ ===== */
function deleteFromList(i){
  if(!confirm("ã“ã®å•é¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
  questions.splice(i,1);
  localStorage.setItem("questions",JSON.stringify(questions));
  onSearch();
}

/* ===== ãƒšãƒ¼ã‚¸ ===== */
function prev(){
  if(page>0){ page--; render(); }
}
function next(){
  if((page+1)*PAGE_SIZE < filtered.length){
    page++; render();
  }
}

/* ===== ç·¨é›† ===== */
function edit(i){
  editingIndex=i;
  const q=questions[i];
  document.getElementById("editor").style.display="block";
  document.getElementById("q").value=q.question;
  document.getElementById("ex").value=q.explain||"";

  const c=document.getElementById("choices");
  const a=document.getElementById("answer");
  c.innerHTML=""; a.innerHTML="";

  q.choices.forEach((x,idx)=>{
    c.innerHTML+=`<div class="choice-row"><input value="${x}"></div>`;
    a.innerHTML+=`<option value="${idx}" ${x===q.answer?"selected":""}>é¸æŠè‚¢${idx+1}</option>`;
  });
}

/* ===== ä¿å­˜ ===== */
function save(){
  if(editingIndex===null)return;
  const inputs=[...document.querySelectorAll("#choices input")];
  questions[editingIndex]={
    question:document.getElementById("q").value,
    choices:inputs.map(i=>i.value),
    answer:inputs[document.getElementById("answer").value].value,
    explain:document.getElementById("ex").value
  };
  localStorage.setItem("questions",JSON.stringify(questions));
  alert("ä¿å­˜ã—ã¾ã—ãŸ");
  onSearch();
}

/* ===== ç·¨é›†ç”»é¢ã‹ã‚‰å‰Šé™¤ ===== */
function removeQ(){
  if(!confirm("ã“ã®å•é¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))return;
  questions.splice(editingIndex,1);
  localStorage.setItem("questions",JSON.stringify(questions));
  document.getElementById("editor").style.display="none";
  onSearch();
}

/* åˆæœŸè¡¨ç¤º */
onSearch();
</script>

</body>
</html>
